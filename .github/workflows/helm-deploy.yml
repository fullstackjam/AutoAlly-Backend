name: Deploy Helm Chart

on:
  push:
    branches:
      - master
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Check Out Repo
        uses: actions/checkout@v2

      - name: Set up Helm
        uses: azure/setup-helm@v1

      - name: Package Helm Chart
        run: helm package helm/autoally-imadapter

      - name: Login to Harbor
        run: helm registry login harbor.fullstackjam.com --username ${{ secrets.HARBOR_USERNAME }} --password ${{ secrets.HARBOR_PASSWORD }}

      - name: Push Chart to Harbor
        run: helm push autoally-imadpter.tgz oci://harbor.fullstackjam.com/autoally-imadapter

      - name: Logout of Harbor
        run: helm registry logout harbor.fullstackjam.com
